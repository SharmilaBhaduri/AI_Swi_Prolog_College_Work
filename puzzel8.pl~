:- use_module(library(lists)).

% Goal state
goal([1,2,3,4,5,6,7,8,0]).

% Move rules
move([A,B,C,D,E,F,G,H,0], [A,B,C,D,E,F,G,0,H], right).
move([A,B,C,D,E,F,G,0,H], [A,B,C,D,E,F,0,G,H], right).
move([A,B,C,D,E,F,0,G,H], [A,B,C,D,E,F,G,0,H], left).
move([A,B,C,D,E,F,G,0,H], [A,B,C,D,E,F,0,G,H], left).
move([A,B,C,D,E,0,G,H,I], [A,B,C,D,0,E,G,H,I], right).
move([A,B,C,D,0,E,G,H,I], [A,B,C,0,D,E,G,H,I], right).
move([A,B,C,0,E,F,G,H,I], [A,B,C,E,0,F,G,H,I], left).
move([A,B,C,D,0,F,G,H,I], [A,B,C,0,D,F,G,H,I], left).

move([A,B,C,D,E,F,G,H,0], [A,B,C,D,E,0,G,H,F], up).
move([A,B,C,D,E,F,G,0,H], [A,B,C,D,0,F,G,E,H], up).
move([A,B,C,D,E,F,0,G,H], [A,B,C,0,E,F,D,G,H], up).
move([A,B,C,D,E,F,G,0,H], [A,B,C,D,E,0,G,F,H], down).
move([A,B,C,D,E,F,G,H,0], [A,B,C,D,E,F,G,0,H], down).
move([A,B,C,D,E,F,0,G,H], [A,B,C,D,0,F,E,G,H], down).

% BFsolve(Start, Solution) :-
    bfs([[Start]], [], Solution).

bfs([[Goal|Rest]|_], _, [Goal|Rest]) :-
    goal(Goal).

bfs([[Current|RestPath]|OtherPaths], Visited, Solution) :-
    findall([Next,Current|RestPath],
            (move(Current, Next, _), \+ member(Next, [Current|RestPath]), \+ member(Next, Visited)),
            NewPaths),
    append(OtherPaths, NewPaths, UpdatedPaths),
    bfs(UpdatedPaths, [Current|Visited], Solution).

% Print path step-by-step
print_steps([]).
print_steps([State|Rest]) :-
    print_state(State), nl,
    print_steps(Rest).

print_state([A,B,C,D,E,F,G,H,I]) :-
    format("~w ~w ~w~n", [A,B,C]),
    format("
